# ðŸŽ¯ Prompt for Devin: Build Jira MCP Server for GitHub Copilot

## Project Overview
Create a complete Jira MCP (Model Context Protocol) server that integrates with GitHub Copilot. The server must enable AI-assisted Jira interactions including searching/querying issues and updating issue status. All organization-specific configurations must be in an external, easily editable configuration file at the top of the project.

## Target Platform
**GitHub Copilot** (not Claude Desktop) - ensure all setup instructions and configurations are for GitHub Copilot integration.

## Technical Requirements

### Technology Stack
- **Language**: Python 3.10+
- **MCP Framework**: `mcp` library
- **HTTP Client**: `httpx` for async requests
- **Configuration**: YAML file (must be at top of project, easily editable)
- **API**: Jira REST API v3 (Cloud)
- **Authentication**: Personal Access Token (PAT) with Bearer authentication

### Project Structure
```
jira-mcp-server/
â”œâ”€â”€ config.yaml            # â­ CONFIGURATION FILE (user edits this - TOP PRIORITY)
â”œâ”€â”€ server.py              # Main MCP server
â”œâ”€â”€ jira_client.py         # Jira API wrapper
â”œâ”€â”€ config_loader.py       # Config file loader
â”œâ”€â”€ requirements.txt       # Python dependencies
â””â”€â”€ README.md             # Complete documentation
```

---

## CRITICAL REQUIREMENT: Configuration File (config.yaml)

**ALL organization-specific settings MUST be in this external YAML file that users can easily edit.**

### Required Configuration Structure

```yaml
# ============================================
# JIRA MCP SERVER CONFIGURATION
# EDIT THESE VALUES FOR YOUR ORGANIZATION
# ============================================

# YOUR JIRA INSTANCE (CHANGE THESE)
jira:
  # Your Jira Cloud URL (no trailing slash)
  base_url: "https://yourcompany.atlassian.net"
  
  # Your Personal Access Token
  # Get from: https://id.atlassian.com/manage-profile/security/api-tokens
  pat_token: "YOUR_PAT_TOKEN_HERE"
  
  # API version (default: "3" for Jira Cloud)
  api_version: "3"

# API ENDPOINTS (customize if your org has custom endpoints)
endpoints:
  search: "/rest/api/{api_version}/search"
  issue: "/rest/api/{api_version}/issue/{issue_key}"
  transitions: "/rest/api/{api_version}/issue/{issue_key}/transitions"
  user_search: "/rest/api/{api_version}/user/search"
  myself: "/rest/api/{api_version}/myself"

# REQUEST SETTINGS
request:
  timeout: 30              # Request timeout in seconds
  max_retries: 3           # Maximum retry attempts
  retry_delay: 1           # Delay between retries (seconds)

# SEARCH DEFAULTS
search:
  default_max_results: 50
  max_allowed_results: 100
  default_fields:
    - "summary"
    - "status"
    - "assignee"
    - "priority"
    - "issuetype"
    - "created"
    - "updated"
    - "description"

# ISSUE DETAILS SETTINGS
issue_details:
  max_comments: 5          # Number of recent comments to display
  fields:
    - "summary"
    - "description"
    - "status"
    - "priority"
    - "assignee"
    - "reporter"
    - "created"
    - "updated"
    - "duedate"
    - "labels"
    - "components"
    - "subtasks"
    - "comment"
    - "issuetype"

# LOGGING CONFIGURATION
logging:
  level: "INFO"           # DEBUG, INFO, WARNING, ERROR, CRITICAL
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  mask_sensitive_data: true  # Mask PAT token in logs

# YOUR ORGANIZATION INFO (optional, for display)
organization:
  name: "Your Company Name"
  common_projects:
    - "PROJ"
    - "BUG"
    - "TASK"

# AUTHENTICATION HEADERS
headers:
  content_type: "application/json"
  accept: "application/json"
```

**Key Points:**
- This file MUST be at the root of the project
- Users should NEVER need to edit Python code for configuration
- All URLs, tokens, endpoints, and settings go here
- Create a `config.example.yaml` as a template

---

## Authentication Requirements

### Personal Access Token (PAT) Authentication

**Method**: Bearer Token in Authorization header

```python
headers = {
    "Authorization": f"Bearer {pat_token}",
    "Content-Type": "application/json",
    "Accept": "application/json"
}
```

**Configuration Location**: `config.yaml` under `jira.pat_token`

**Documentation Required**:
Include in README how to get PAT token:
1. Visit: https://id.atlassian.com/manage-profile/security/api-tokens
2. Click "Create API token"
3. Name it (e.g., "GitHub Copilot MCP")
4. Copy token and paste into `config.yaml`

---

## Core Features to Implement

### Feature 1: Search Jira Issues

**Tool Name**: `search_jira_issues`

**Description**: Search Jira issues using JQL (Jira Query Language)

**Input Schema**:
```python
{
    "type": "object",
    "properties": {
        "jql": {
            "type": "string",
            "description": "JQL query string"
        },
        "max_results": {
            "type": "integer",
            "description": "Maximum results to return",
            "default": 50  # from config
        }
    },
    "required": ["jql"]
}
```

**Jira API**: `GET /rest/api/3/search?jql={jql}&maxResults={max_results}`

**Output Format** (human-readable):
```
Found {count} issues:

â€¢ PROJ-123: Implement authentication
  Status: In Progress | Priority: High | Assignee: John Doe
  Created: 2024-01-15 10:30 AM

â€¢ PROJ-124: Fix login bug
  Status: Open | Priority: Critical | Assignee: Unassigned
  Created: 2024-01-18 02:15 PM

Total: 2 issues
```

**Common JQL Examples to Document**:
- `assignee = currentUser() AND status = Open`
- `project = PROJ AND priority = High`
- `status IN ("To Do", "In Progress")`
- `created >= -7d`

---

### Feature 2: Get Issue Details

**Tool Name**: `get_jira_issue`

**Description**: Get detailed information about a specific issue

**Input Schema**:
```python
{
    "type": "object",
    "properties": {
        "issue_key": {
            "type": "string",
            "description": "Issue key (e.g., PROJ-123)"
        }
    },
    "required": ["issue_key"]
}
```

**Jira API**: `GET /rest/api/3/issue/{issue_key}`

**Output Format**:
```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Issue: PROJ-123
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Summary: Implement user authentication
Type: Story
Status: In Progress
Priority: High

Assignee: John Doe (john@company.com)
Reporter: Jane Smith (jane@company.com)

Created: 2024-01-15 10:30 AM
Updated: 2024-01-20 03:45 PM

Description:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Need to implement OAuth 2.0 authentication
for the web application.
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Labels: backend, security

Subtasks (2):
  â€¢ PROJ-123-1: Setup OAuth [Done]
  â€¢ PROJ-123-2: Add login UI [In Progress]

Recent Comments (last 3):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
[2024-01-19] John: OAuth complete
[2024-01-18] Jane: Please prioritize
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

View: https://yourcompany.atlassian.net/browse/PROJ-123
```

---

### Feature 3: Update Issue Status

**Tool Name**: `transition_jira_issue`

**Description**: Change issue status (To Do â†’ In Progress â†’ Done)

**Input Schema**:
```python
{
    "type": "object",
    "properties": {
        "issue_key": {
            "type": "string",
            "description": "Issue key (e.g., PROJ-123)"
        },
        "status": {
            "type": "string",
            "description": "Target status name (case-insensitive)"
        }
    },
    "required": ["issue_key", "status"]
}
```

**Implementation Logic**:
1. Get issue to show current status
2. Get available transitions: `GET /rest/api/3/issue/{issue_key}/transitions`
3. Find transition ID by matching status name (case-insensitive)
4. Execute transition: `POST /rest/api/3/issue/{issue_key}/transitions`

**Output Format**:
```
âœ“ Successfully transitioned PROJ-123
  From: To Do
  To: In Progress
  View: https://yourcompany.atlassian.net/browse/PROJ-123
```

**Error Handling** (if invalid transition):
```
Cannot transition PROJ-123 to 'Testing'.

Current status: To Do

Available transitions:
  â€¢ In Progress
  â€¢ Blocked
  â€¢ Won't Do

Please use one of the available transitions.
```

---

## Implementation Details

### File 1: config_loader.py

Create a configuration loader class with:

**Required Methods**:
```python
class ConfigLoader:
    def __init__(self, config_path: str = "config.yaml")
    def get(self, *keys, default=None)  # Get nested config values
    def get_endpoint(self, endpoint_name: str, **kwargs) -> str  # Get formatted endpoint
    def get_full_url(self, endpoint_name: str, **kwargs) -> str  # Get complete URL
    def get_headers(self) -> Dict[str, str]  # Get auth headers
    def mask_token(self, text: str) -> str  # Mask PAT in logs
```

**Validation**:
- Check if `config.yaml` exists
- Verify required fields are present
- Ensure PAT token is not the placeholder "YOUR_PAT_TOKEN_HERE"
- Give helpful error messages if configuration is invalid

---

### File 2: jira_client.py

Create Jira API client with:

**Required Methods**:
```python
class JiraClient:
    def __init__(self, config: ConfigLoader)
    async def search_issues(self, jql: str, max_results: int) -> str
    async def get_issue(self, issue_key: str) -> str
    async def transition_issue(self, issue_key: str, target_status: str) -> str
    async def _make_request(self, method: str, url: str, **kwargs) -> Dict
    def _format_search_results(self, data: Dict) -> str
    def _format_issue_details(self, data: Dict) -> str
    def _extract_description(self, adf_content: Any) -> str  # Parse ADF format
```

**Key Requirements**:
- Use Bearer token authentication from config
- Implement retry logic (max_retries from config)
- Handle Jira's Atlassian Document Format (ADF) for descriptions
- Format dates to human-readable format
- Comprehensive error handling

---

### File 3: server.py

Main MCP server implementing:

**Required Functions**:
```python
@app.list_tools() -> list[Tool]  # List available tools
@app.call_tool(name, arguments) -> Sequence[TextContent]  # Handle tool calls
async def main()  # Main entry point
```

**Tool Definitions**:
- search_jira_issues
- get_jira_issue
- transition_jira_issue

**Startup**:
- Load configuration
- Validate configuration
- Initialize Jira client
- Log startup message with org name and URL

---

### File 4: requirements.txt

```
mcp>=0.9.0
httpx>=0.27.0
pyyaml>=6.0.1
```

---

## GitHub Copilot Integration

### Configuration File Location

The MCP server configuration for GitHub Copilot varies by setup:

**Option 1: GitHub Copilot CLI**
Create: `~/.github-copilot/mcp-config.json` (Mac/Linux) or `%USERPROFILE%\.github-copilot\mcp-config.json` (Windows)

**Option 2: VS Code with Copilot Extension**
Add to `.vscode/settings.json` in your project

**Option 3: Claude Desktop** (fallback if user has this)
Add to Claude Desktop config

### Configuration Format

```json
{
  "mcpServers": {
    "jira": {
      "command": "python",
      "args": ["/absolute/path/to/server.py"]
    }
  }
}
```

**CRITICAL**: The path MUST be absolute (full path), not relative.

### Include All Three Options in README

Document all three integration methods so users can choose based on their setup.

---

## Error Handling Requirements

### Must Handle These Scenarios

1. **Configuration Errors**:
   - Missing `config.yaml` â†’ "Configuration file not found. Please create config.yaml"
   - Invalid PAT token placeholder â†’ "Please set your PAT token in config.yaml"
   - Missing required fields â†’ "Missing required config: jira.base_url"

2. **Authentication Errors**:
   - 401 â†’ "Authentication failed. Check your PAT token in config.yaml"
   - 403 â†’ "Permission denied. Verify token has required permissions"

3. **API Errors**:
   - 404 â†’ "Resource not found: {resource}"
   - Invalid JQL â†’ "Invalid JQL query: {jql}. Error: {details}"
   - Invalid issue key â†’ "Invalid issue key format. Expected: PROJ-123"

4. **Network Errors**:
   - Connection timeout â†’ Retry with delay from config
   - Max retries exceeded â†’ "Failed to connect to Jira: {error}"

5. **Transition Errors**:
   - Invalid status â†’ Show available transitions
   - Workflow error â†’ "Workflow error: {details}"

---

## Documentation Requirements (README.md)

### Must Include

1. **Quick Start** (top of README):
   - Installation steps
   - Configuration steps
   - Testing steps

2. **PAT Token Setup**:
   - Step-by-step with screenshots/links
   - How to get token
   - Where to paste it

3. **GitHub Copilot Configuration**:
   - All three integration methods
   - Exact file locations
   - Example configurations
   - How to find absolute path

4. **Usage Examples**:
   - Natural language prompts to try
   - Common JQL queries
   - Example conversations

5. **Troubleshooting**:
   - Common errors and solutions
   - How to check logs
   - How to test the server

6. **Configuration Reference**:
   - Explain each config option
   - When to customize endpoints
   - How to adjust defaults

---

## Testing Checklist

Before delivery, verify:

### Configuration
- âœ… `config.yaml` loads successfully
- âœ… Validation catches missing required fields
- âœ… Helpful error messages for invalid config
- âœ… PAT token is masked in all logs

### Search Issues
- âœ… Can search with simple JQL: `project = PROJ`
- âœ… Can search with complex JQL: `assignee = currentUser() AND status = Open`
- âœ… Handles "No results found" gracefully
- âœ… Handles invalid JQL syntax with helpful error

### Get Issue
- âœ… Can fetch issue details by key
- âœ… Formats output nicely with all fields
- âœ… Handles non-existent issues
- âœ… Validates issue key format
- âœ… Extracts text from ADF descriptions correctly

### Transition Issue
- âœ… Can change status successfully
- âœ… Shows available transitions when invalid status provided
- âœ… Case-insensitive status matching works
- âœ… Shows before/after status

### Authentication
- âœ… PAT Bearer token authentication works
- âœ… Clear error when token is invalid
- âœ… Clear error when token is missing

### GitHub Copilot Integration
- âœ… Server runs via stdio transport
- âœ… Configuration examples provided for all Copilot setups
- âœ… Absolute path requirement documented

---

## Deliverables

1. **config.yaml** - Template configuration file (with placeholder values)
2. **config_loader.py** - Configuration loader with validation
3. **jira_client.py** - Jira API client with PAT auth
4. **server.py** - Main MCP server
5. **requirements.txt** - Python dependencies
6. **README.md** - Complete documentation with:
   - Quick start guide
   - PAT token setup instructions
   - GitHub Copilot integration (all methods)
   - Usage examples
   - Troubleshooting guide
   - Configuration reference

---

## Success Criteria

The project is complete when:

1. âœ… User can edit `config.yaml` to configure everything (no code editing needed)
2. âœ… PAT token authentication works correctly
3. âœ… Can search Jira issues with JQL
4. âœ… Can get detailed issue information
5. âœ… Can update issue status (transition)
6. âœ… Integrates with GitHub Copilot (documentation for all methods)
7. âœ… All errors handled with helpful messages
8. âœ… README has complete setup instructions
9. âœ… Code is clean, documented, and follows Python best practices
10. âœ… Configuration validation prevents common mistakes

---

## Key Priorities

1. **Configuration First**: Make `config.yaml` the single source of truth
2. **PAT Authentication**: Use Bearer token correctly
3. **GitHub Copilot Integration**: Document all integration methods
4. **User-Friendly**: No code editing required for configuration
5. **Error Messages**: Helpful, actionable error messages
6. **Documentation**: Complete setup guide for non-technical users

---

**Build a production-ready Jira MCP server for GitHub Copilot with everything configurable via external YAML file.**
